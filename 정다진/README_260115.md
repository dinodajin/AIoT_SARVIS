# 20260115
## 시스템 아키텍처

![system architecture.png](./images/new%20system%20architecture.png)

### 변경사항
1. Local DB 추가 : 사용자 정보를 담아두고 제어 및 구동에 관여
2. 라즈베리파이 기능 추가 : 실행 중인 안드로이드 앱(유튜브 등)을 조작 => 현재는 매크로를 통해 조작됨
3. 앱 수정 : 기능에 따라 재구성

## 요구사항 명세서
| ID | 업무 구분(대) | 업무 구분(중) | 요구사항 명 | 요구사항 내용 | 중요도 | 담당자
| --- | --- | --- | --- | --- | --- | --- |
| VIS-ID-01 | 온디바이스 AI | 사용자 식별 및 등록 | 사전 학습 모델 로드 | 검증된 대용량 데이터로 학습된 InsightFace(ArcFace) / FaceNet 모델을 젯슨 나노에 탑재 | 최상 | --- |
| VIS-ID-02 | 온디바이스 AI | 사용자 식별 및 등록 | 사용자 고유 특징(Vector) 등록 | 특정 사용자 등록 시, 카메라가 360도(정면, 좌우, 상하) 각도에서 얼굴을 캡처하여 고유 벡터값으로 저장 | 최상 | --- |
| VIS-ID-03 | 온디바이스 AI | 사용자 식별 및 등록 | 실시간 매칭 (1:N Matching) | 현재 감지된 얼굴의 벡터를 등록된 사용자 DB의 벡터들과 비교하여 누구인지(User ID) 판별 | 최상 | --- |
| VIS-ID-04 | 온디바이스 AI | 사용자 식별 및 등록 | 미등록 사용자 예외 처리 | 등록되지 않은 인물은 'Unknown'으로 분류하고, 추적 대상에서 제외하거나 기본 설정값 적용 | 상 | --- |
| VIS-TG-01 | 온디바이스 AI | 명령자 타겟팅 및 개인화 | 명령 인물 고정 (Lock-on) | 음성 명령 시점에 식별된 특정 사용자 ID를 '추적 타겟'으로 고정 | 최상 | --- |
| VIS-TG-02 | 온디바이스 AI | 명령자 타겟팅 및 개인화 | 사용자별 오프셋 적용 | 식별된 ID 별로 앱에서 설정한 좌표 보정값 적용 | 상 | --- |
| VIS-TG-03 | 온디바이스 AI | 명령자 타겟팅 및 개인화 | 정밀 주시 확인 | 사용자가 기기를 정면으로 바라보는지 랜드마크를 통해 확인 후, 최적의 각도로 초기 정렬 수행 | 중 | --- |
| VIS-RT-01 | 온디바이스 AI | 실시간 추종 | 연속 추적 | 매 프레임 식별 과정을 거치지 않고, 한번 고정된 바운딩 박스를 KCF / CSRT 알고리즘으로 저지연 추적 | 하 | --- |
| VIS-RT-02 | 온디바이스 AI | 실시간 추종 | 360도 각도 대응 | 사용자가 고개를 돌려도 끊김없이 추적 유지 | 하 | --- |
| VIS-RT-03 | 온디바이스 AI | 실시간 추종 | 좌표 필터 | 젯슨 나노에서 계산된 좌표가 튀지 않도록 지수 이동 평균 필터를 적용하여 모터 진동 방지 | 하 | --- |
| VIS-RT-04 | 온디바이스 AI | 실시간 추종 | 추적 범위 제한 | 카메라 화각을 벗어나기 직저너 경고 신호를 라즈베리파이에 송신하여 회전 유도 | 하 | --- |
| COM-INT-01 | 통신 | 실시간 구동 명령 | 목표 좌표 및 상태 | 바이너리 패킷 송신 | 최상 | --- |
| COM-INT-02 | 통신 | 안전 통신 | 하트비트 신호 | 젯슨에서 파이로 주기적인 신호를 보내 통신 단절 감지시 모터 정지 유도 | 최상 | --- |
| COM-INT-03 | 통신 | 시스템 피드백 | 하드웨어 상태 정보 | 라즈베리파이에서 젯슨으로 모터각도, 오류 상태와 같은 정보 전송 | 중 | --- |
| COM-INT-04 | 통신 | 로그 기록 | 시스템 텔레메트리 | 명령 수행 결과 및 에러 코드를 젯슨으로 전송하여 데이터 로깅 | 상 | --- |
| COM-EXT-01 | 통신 | TCP 통신 | 하드웨어 제어 명령 송수신 | Jetson → Raspberry Pi  | 상 | --- |
| COM-EXT-02 | 통신 | 보안 로그 | 특징점 벡터 | 앱에서 추출된 128차원 얼굴 특징점만  JSON 형태로 암호화 전송 | 최상 | --- |
| COM-EXT-03 | 통신 | 개인 설정 동기화 | 사용자 프로필 | 사용자별 타겟 오프셋, 추적 속도 가중치 설정을 파이의 API 서버로 전송 및 업데이트 | 상 | --- |
| COM-EXT-04 | 통신 | 실시간 대시보드 | 모니터링 데이터 | WebSockets을 통해 현재 추적 대상 정보 갱신 | 상 | --- |
| COM-EXT-05 | 통신 | 초기 페어링 | 기기 점유 인증 | 초기 기기 등록 시 와이파이 정보 저달 및 사용자 기기 점유권 확인 | 중 | --- |


## 내일 할 일
- ERD 완성 도와주기
- 카메라 개발 환경 테스트
- 사용할 영상 AI 모델 공부