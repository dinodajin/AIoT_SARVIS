# SARVIS 시스템 와이어프레임

**버전:** 1.0  
**작성일:** 2026-01-30  
**기준 문서:** Use_case_revised.md v2.0, API_specification.md v1.0

---

## 1. 전체 시스템 아키텍처

### 1.1 시스템 구성도

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                           앱 (Android)                                     │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────────────┐  │
│  │                          UI Layer                                      │  │
│  │  - 로그인 화면, 회원가입 화면, 메인 화면(홈/제어), 메뉴                │  │
│  └─────────────────────────────────────────────────────────────────────────────┘  │
│                                    │                                        │
│  ┌─────────────────────────────────────────────────────────────────────────────┐  │
│  │                     Business Logic Layer                                │  │
│  │  - 세션 관리, 기기 연결 관리, 로봇 제어, 프리셋 관리                   │  │
│  │  - Foreground Service (핸드프리 제어)                                  │  │
│  └─────────────────────────────────────────────────────────────────────────────┘  │
│                                    │                                        │
│  ┌─────────────────────────────────────────────────────────────────────────────┐  │
│  │                      Network Layer                                     │  │
│  │  - REST API Client (HTTPS)                                            │  │
│  │  - WebSocket Client (WSS) - 기기 상태 알림                               │  │
│  │  - HTTP Client (로컬) - Jetson 통신                                    │  │
│  └─────────────────────────────────────────────────────────────────────────────┘  │
│                                    │                                        │
│  ┌─────────────────────────────────────────────────────────────────────────────┐  │
│  │                      Storage Layer                                    │  │
│  │  - LocalStorage: JWT 토큰, 세션 정보                                   │  │
│  └─────────────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    │ REST API (HTTPS)
                                    │ - 인증, 회원가입, 기기 관리
                                    │ - 로봇 제어, 프리셋 관리
                                    │ - 사용자 관리, 생체 정보 관리
                                    ↓
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                        서버 (EC2)                                          │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────────────┐  │
│  │                    REST API Layer                                       │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                      │  │
│  │  │   인증      │  │  회원가입   │  │ 기기 관리   │                      │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                      │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                      │  │
│  │  │ 세션 관리   │  │  로봇 제어   │  │ 프리셋 관리  │                      │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                      │  │
│  │  ┌─────────────┐  ┌─────────────┐                                       │  │
│  │  │ 사용자 관리  │  │ 생체 정보 관리│                                       │  │
│  │  └─────────────┘  └─────────────┘                                       │  │
│  └─────────────────────────────────────────────────────────────────────────────┘  │
│                                    │                                        │
│  ┌─────────────────────────────────────────────────────────────────────────────┐  │
│  │                  WebSocket Handler (하트비트)                              │  │
│  │  - Jetson 하트비트 수신 (10초 간격)                                     │  │
│  │  - Connection 상태 업데이트                                             │  │
│  │  - 기기 온라인/오프라인 알림                                            │  │
│  └─────────────────────────────────────────────────────────────────────────────┘  │
│                                    │                                        │
│                                    │ WebSocket (WSS) - 하트비트만
│                                    ↓
└─────────────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    │ WebSocket (WSS) - 하트비트만
                                    │ - 10초 간격 하트비트 전송
                                    ↓
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                          Jetson                                             │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────────────┐  │
│  │                 WebSocket Client (하트비트)                                │  │
│  │  - 서버로 하트비트 전송 (10초 간격)                                      │  │
│  │  - 서버로부터 heartbeat_ack 수신                                          │  │
│  │  - Wi-Fi 신호 강도 전송                                                  │  │
│  └─────────────────────────────────────────────────────────────────────────────┘  │
│                                    │                                        │
│                                    │ 내부 통신 (유선)
│                                    ↓
┌─────────────────────────────────────────────────────────────────────────────┐      │
│                    RPi (로봇 제어)                                    │      │
│  ┌─────────────────────────────────────────────────────────────────────┐  │      │
│  │                     Motor Controller                               │  │      │
│  │  - 위치 제어 (X, Y, Z)                                            │  │      │
│  │  - 회전 제어 (Tilt, HAS)                                            │  │      │
│  │  - 모터 드라이버 제어                                                │  │      │
│  └─────────────────────────────────────────────────────────────────────┘  │      │
└─────────────────────────────────────────────────────────────────────────────┘      │
                                    │                                        │
│                                    │ HTTP Server (로컬)
│                                    ↓
┌─────────────────────────────────────────────────────────────────────────────┐      │
│                HTTP Handler (로컬 벡터화)                               │      │
│  ┌─────────────────────────────────────────────────────────────────────┐  │      │
│  │                     Vectorization Engine                           │  │      │
│  │  - 얼굴 임베딩: Face Recognition Model (512-dim)                  │  │      │
│  │  - 음성 임베딩: Voice Recognition Model (256-dim)                  │  │      │
│  │  - 코사인 유사도 계산 (threshold: 0.48)                               │  │      │
│  └─────────────────────────────────────────────────────────────────────┘  │      │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐      │
│  │                   HTTP Endpoints (로컬)                            │      │
│  │  - /register/upload: 회원가입 벡터화                                │      │
│  │  - /auth/face-verify: 로그인 벡터화                                 │      │
│  │  - /biometric/face-update: 얼굴 재설정                              │      │
│  │  - /biometric/voice-update: 음성 재설정                             │      │
│  └─────────────────────────────────────────────────────────────────────┘      │
│                                    │                                        │
└─────────────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    │ Jetson HTTP (로컬)
                                    │ - 얼굴/음성 원본 파일 전송
                                    │ - 벡터 데이터 수신
                                    ↓
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                        앱 (Android) - 로컬 통신                               │
│  ┌─────────────────────────────────────────────────────────────────────────────┐  │
│  │                     Biometric Handler                                  │  │
│  │  - Jetson으로 얼굴/음성 원본 파일 전송                                    │  │
│  │  - Jetson으로부터 벡터 데이터 수신                                         │  │
│  │  - 서버로 벡터 데이터 전송 (REST API)                                     │  │
│  └─────────────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

### 1.2 통신 방식 요약

| 통신 방식 | 프로토콜 | 용도 | 간격 | 데이터 형식 |
|-----------|----------|------|------|-------------|
| **REST API** | HTTPS | 모든 비즈니스 로직 | 요청 시 | JSON |
| **WebSocket** | WSS | 하트비트 (Jetson-서버) | 10초 | JSON |
| **Jetson HTTP** | HTTP (로컬) | 벡터화 연산 | 요청 시 | FormData/JSON |
| **내부 통신** | 유선 | RPi 제어 | 실시간 | 전기 신호 |

---

## 2. 하트비트 통신 와이어프레임

### 2.1 하트비트 통신 흐름

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          Jetson                                     │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │                 WebSocket Client                                   │  │
│  │                                                                │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │           하트비트 전송 루프 (10초 간격)               │  │  │
│  │  │                                                          │  │  │
│  │  │  1. 현재 시간 및 Wi-Fi 신호 강도 확인                      │  │  │
│  │  │  2. JSON 메시지 생성                                       │  │  │
│  │  │     {                                                      │  │  │
│  │  │       "type": "heartbeat",                                   │  │  │
│  │  │       "device_id": "JETSON-001",                             │  │  │
│  │  │       "timestamp": 1640739900,                              │  │  │
│  │  │       "wifi_signal": 85,                                     │  │  │
│  │  │       "connection_status": "connected"                        │  │  │
│  │  │     }                                                      │  │  │
│  │  │  3. 서버로 WebSocket 메시지 전송                            │  │  │
│  │  │  4. 서버로부터 heartbeat_ack 수신 대기                      │  │  │
│  │  │  5. 응답 수신 시 로그 기록                                   │  │  │
│  │  │  6. 10초 대기 후 다음 하트비트 전송                          │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│         │                                                              │
│         ↓ WebSocket (WSS)                                              │
└─────────┼───────────────────────────────────────────────────────────────────┘
          │
          ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│                        서버 (EC2)                                     │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │                  WebSocket Handler                                 │  │
│  │                                                                │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │           하트비트 수신 처리                                │  │  │
│  │  │                                                          │  │  │
│  │  │  1. Jetson으로부터 heartbeat 메시지 수신                    │  │  │
│  │  │  2. 메시지 파싱 및 검증                                   │  │  │
│  │  │  3. Database에 기기 상태 저장                               │  │  │
│  │  │     - Connection.wifi_signal = 85                            │  │  │
│  │  │     - Connection.last_heartbeat = 1640739900                  │  │  │
│  │  │     - Connection.connection_status = "connected"               │  │  │
│  │  │  4. Jetson으로 heartbeat_ack 전송                          │  │  │
│  │  │     {                                                     │  │  │
│  │  │       "type": "heartbeat_ack",                                │  │  │
│  │  │       "device_id": "JETSON-001",                             │  │  │
│  │  │       "timestamp": 1640739900                                │  │  │
│  │  │     }                                                     │  │  │
│  │  │  5. 앱으로 상태 변경 알림 (WebSocket 연결 시)                 │  │  │
│  │  │     {                                                     │  │  │
│  │  │       "type": "device_online" / "device_offline",            │  │  │
│  │  │       "device_id": "JETSON-001",                             │  │  │
│  │  │       "timestamp": 1640739900                                │  │  │
│  │  │     }                                                     │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│         │                                                              │
│         ↓                                                              │
┌─────────────────────────────────────────────────────────────────────────────┐
│                     Database (PostgreSQL)                                 │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │                  Connection Table                                 │  │
│  │  - connection_id: 1                                              │  │
│  │  - device_id: JETSON-001                                         │  │
│  │  - wifi_signal: 85                                                │  │
│  │  - last_heartbeat: 2026-01-30 10:30:00                           │  │
│  │  - connection_status: CONNECTED                                     │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────┘
          │
          ↓ WebSocket (앱 연결)
┌─────────────────────────────────────────────────────────────────────────────┐
│                        앱 (Android)                                   │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │                 WebSocket Client (상태 알림)                        │  │
│  │                                                                │  │
│  │  1. 서버로부터 device_online/device_offline 알림 수신           │  │
│  │  2. 알림 파싱                                                   │  │
│  │  3. 기기 연결 상태 인디케이터 업데이트                            │  │
│  │     - online: 녹색                                              │  │
│  │     - offline: 빨간색                                             │  │
│  │  4. 오프라인 시 반투명 오버레이 (Opacity 0.5) 적용              │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 하트비트 타임아웃 처리

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        서버 (EC2)                                     │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │              하트비트 타임아웃 감지 로직                          │  │
│  │                                                                │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │           Background Worker (매분 실행)                     │  │  │
│  │  │                                                          │  │  │
│  │  │  1. 모든 Connection 조회                                    │  │  │
│  │  │  2. last_heartbeat 확인                                     │  │  │
│  │  │  3. 마지막 하트비트으로부터 30초 경과 여부 확인                │  │  │
│  │  │     - 경과 시: connection_status → "DISCONNECTED"              │  │  │
│  │  │     - 앱으로 device_offline 알림 전송                        │  │  │
│  │  │  4. 60분 유예 세션 시작 타이머                            │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│         │                                                              │
│         ↓                                                              │
┌─────────────────────────────────────────────────────────────────────────────┐
│                     세션 만료 로직                                     │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │         60분 유예 세션 타이머 경과 시                             │  │
│  │                                                                │  │
│  │  1. connection_status: "DISCONNECTED" 상태 확인                   │  │
│  │  2. 연결 해제 시점으로부터 60분 경과 여부 확인                    │  │
│  │  3. 60분 경과 시 세션 만료                                      │  │
│  │     - Session 삭제                                               │  │
│  │     - 앱으로 세션 만료 알림 전송                                 │  │
│  │  4. 앱에서 로그아웃 처리                                        │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 3. 얼굴 인식 로그인 와이어프레임

### 3.1 얼굴 인식 로그인 흐름

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     앱 (Android) - 로그인 화면                          │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │                    얼굴 스캔 UI                                  │  │
│  │  1. 카메라 프리뷰 표시                                           │  │
│  │  2. 얼굴 인식 가이드라인 표시                                     │  │
│  │  3. "얼굴을 중앙에 맞춰주세요" 안내 메시지                         │  │
│  │  4. 3초 후 얼굴 이미지 캡처                                      │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│         │                                                              │
│         │ Jetson HTTP (로컬)                                          │
│         ↓                                                              │
└─────────┼───────────────────────────────────────────────────────────────────┘
          │
          ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│                          Jetson                                     │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │                HTTP Handler (얼굴 벡터화)                         │  │
│  │  1. 얼굴 이미지 수신 (FormData: face_image)                       │  │
│  │  2. 이미지 전처리 (Resize, Normalize)                            │  │
│  │  3. Face Recognition Model 추론                                    │  │
│  │  4. 얼굴 벡터 추출 (512-dim)                                    │  │
│  │  5. 응답 생성                                                    │  │
│  │     {                                                         │  │
│  │       "success": true,                                           │  │
│  │       "face_vector": [0.123, -0.456, 0.789, ...]                 │  │
│  │     }                                                         │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│         │                                                              │
│         ↓ REST API (HTTPS)                                            │
└─────────┼───────────────────────────────────────────────────────────────────┘
          │
          ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│                        서버 (EC2)                                     │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │               REST API Handler: 얼굴 인증                         │  │
│  │  1. POST /api/auth/face-verify 수신                              │  │
│  │  2. face_vector 파싱                                             │  │
│  │  3. Database에서 모든 User.face_vector 조회                        │  │
│  │  4. 코사인 유사도 계산                                             │  │
│  │     - similarity = cos(face_vector, user.face_vector)              │  │
│  │     - threshold: 0.48                                           │  │
│  │  5. 가장 높은 similarity >= 0.48인 User 찾기                      │  │
│  │  6. JWT 토큰 생성 (HS256, 24시간)                              │  │
│  │  7. Session 생성                                                 │  │
│  │  8. 응답 생성                                                    │  │
│  │     {                                                         │  │
│  │       "success": true,                                           │  │
│  │       "data": {                                                 │  │
│  │         "user_id": 1,                                            │  │
│  │         "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",       │  │
│  │         "user": {                                                │  │
│  │           "user_id": 1,                                          │  │
│  │           "nickname": "대연",                                     │  │
│  │           "email": "dae_lee@example.com"                          │  │
│  │         },                                                      │  │
│  │         "session_id": 1                                          │  │
│  │       }                                                         │  │
│  │     }                                                         │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│         │                                                              │
│         ↓ REST API Response (HTTPS)                                     │
└─────────┼───────────────────────────────────────────────────────────────────┘
          │
          ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│                        앱 (Android)                                   │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │                    로그인 완료 처리                              │  │
│  │  1. 응답 수신                                                   │  │
│  │  2. JWT 토큰 LocalStorage 저장                                   │  │
│  │  3. Session ID 저장                                              │  │
│  │  4. "사용자 인식 완료!" 메시지 표시                               │  │
│  │  5. 기존 프리셋 목록 조회                                       │  │
│  │  6. 프리셋 선택 UI 표시                                          │  │
│  │  7. 프리셋 선택 시 메인 화면(홈 탭)으로 이동                      │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. 로봇 제어 명령 와이어프레임

### 4.1 로봇 제어 명령 흐름

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                   앱 (Android) - 홈/제어 탭                          │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │                    사용자 입력 처리                               │  │
│  │                                                                │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │  방법 1: 음성 명령                                      │  │  │
│  │  │  1. 사용자 "따라와" 발음                                    │  │  │
│  │  │  2. Jetson 마이크에서 음성 인식                              │  │  │
│  │  │  3. 명령 파싱: "follow"                                     │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  │                                                                │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │  방법 2: 버튼 클릭                                       │  │  │
│  │  │  1. "따라와" 토글 ON                                      │  │  │
│  │  │  2. 명령 결정: "follow"                                     │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│         │                                                              │
│         │ REST API (HTTPS)                                            │
│         ↓                                                              │
└─────────┼───────────────────────────────────────────────────────────────────┘
          │
          ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│                        서버 (EC2)                                     │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │               REST API Handler: 로봇 제어                         │  │
│  │  1. POST /api/robot/command 수신                               │  │
│  │  2. session_id 확인                                              │  │
│  │  3. command 파싱: "follow"                                      │  │
│  │  4. Session.robot_status 업데이트                               │  │
│  │     - robot_status: "TRACKING"                                   │  │
│  │     - last_voice_command: "따라와"                               │  │
│  │  5. 로봇 제어 신호 생성 (내부 처리)                             │  │
│  │  6. 응답 생성                                                  │  │
│  │     {                                                         │  │
│  │       "success": true,                                           │  │
│  │       "message": "명령 전송 완료"                                 │  │
│  │     }                                                         │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│         │                                                              │
│         ↓ 내부 통신 (유선 - RPi)                                      │
└─────────┼───────────────────────────────────────────────────────────────────┘
          │
          ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│                          Jetson                                     │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │                    로봇 제어 신호 처리                            │  │
│  │  1. 서버로부터 제어 신호 수신                                    │  │
│  │  2. 명령 파싱: "follow"                                        │  │
│  │  3. RPi로 제어 신호 전송                                          │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│         │                                                              │
│         ↓                                                              │
┌─────────────────────────────────────────────────────────────────────────────┐
│                      RPi (로봇 제어)                                │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │                   Motor Controller                                 │  │
│  │  1. 제어 신호 수신: "follow"                                    │  │
│  │  2. 추적 모드 활성화                                              │  │
│  │  3. 모터 제어                                                    │  │
│  │     - 사용자 추적: 카메라에서 사용자 위치 감지                     │  │
│  │     - 위치 조정: X, Y 축 제어                                    │  │
│  │  4. 완료 신호 Jetson 전송                                       │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│         │                                                              │
│         ↓                                                              │
┌─────────────────────────────────────────────────────────────────────────────┐
│                          Jetson                                     │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │                   완료 신호 처리                                  │  │
│  │  1. RPi로부터 완료 신호 수신                                     │  │
│  │  2. REST API (HTTPS)                                         │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│         │                                                              │
│         ↓ REST API (HTTPS)                                            │
└─────────┼───────────────────────────────────────────────────────────────────┘
          │
          ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│                        서버 (EC2)                                     │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │            REST API Handler: 로봇 상태 업데이트                    │  │
│  │  1. PUT /api/sessions/{session_id}/robot-status 수신             │  │
│  │  2. Session.robot_status 업데이트                              │  │
│  │     - robot_status: "IDLE"                                     │  │
│  │  3. 응답 생성                                                  │  │
│  │     {                                                         │  │
│  │       "success": true,                                           │  │
│  │       "data": {                                                 │  │
│  │         "session_id": 1,                                        │  │
│  │         "robot_status": "IDLE"                                   │  │
│  │       }                                                         │  │
│  │     }                                                         │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│         │                                                              │
│         ↓ REST API Response (HTTPS)                                     │
└─────────┼───────────────────────────────────────────────────────────────────┘
          │
          ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│                        앱 (Android)                                   │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │                    UI 업데이트                                 │  │
│  │  1. 응답 수신                                                   │  │
│  │  2. 로봇 상태 UI 업데이트                                       │  │
│  │     - 상태: "대기 중" (회색)                                    │  │
│  │  3. 텍스트 메시지 표시: "이동 완료"                               │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 4.2 로봇 제어 명령 매핑

| 명령어 | 음성 | 버튼 | REST API | robot_status | 색상 |
|--------|------|-------|-----------|---------------|-------|
| 따라와 | "따라와" | 토글 ON | command: "follow" | TRACKING | 녹색 |
| 이리 와 | "이리 와" / "내 앞으로" | "이리 와" 버튼 | command: "come_here" | MOVING | 파란색 |
| 멈춰 | "멈춰" | - | command: "stop" | IDLE | 회색 |
| 시야 밖으로 | "저리 가" / "시야 밖으로" | "시야 밖으로" 버튼 | command: "aside" | ASIDE | 주황색 |
| 위쪽 이동 | "위로" | "↑" 버튼 | command: "move_up" | MOVING | 파란색 |
| 아래쪽 이동 | "아래로" | "↓" 버튼 | command: "move_down" | MOVING | 파란색 |
| 왼쪽 이동 | "왼쪽으로" | "←" 버튼 | command: "move_left" | MOVING | 파란색 |
| 오른쪽 이동 | "오른쪽으로" | "→" 버튼 | command: "move_right" | MOVING | 파란색 |

---

## 5. 회원가입 완료 와이어프레임

### 5.1 회원가입 완료 흐름

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                  앱 (Android) - 회원가입 완료 화면                      │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │                    회원가입 완료 버튼                            │  │
│  │  1. "회원가입 완료" 버튼 클릭                                  │  │
│  │  2. UUID 전송 (회원가입 단계에서 발급)                         │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│         │                                                              │
│         │ REST API (HTTPS)                                            │
│         ↓                                                              │
└─────────┼───────────────────────────────────────────────────────────────────┘
          │
          ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│                        서버 (EC2)                                     │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │            REST API Handler: 회원가입 완료                         │  │
│  │  1. POST /api/register/complete/ 수신                            │  │
│  │  2. UUID 파싱                                                 │  │
│  │  3. Redis 캐시에서 임시 데이터 조회                             │  │
│  │     Key: signup:temp:{uuid}                                      │  │
│  │     Fields:                                                      │  │
│  │       - login_id: "dae_lee"                                     │  │
│  │       - password: "hashed_password"                               │  │
│  │       - email: "dae_lee@example.com"                             │  │
│  │       - nickname: "대연"                                        │  │
│  │       - face_vector: [0.123, -0.456, ...]                       │  │
│  │       - voice_vector: [0.123, -0.456, ...]                      │  │
│  │  4. Database 트랜잭션 시작                                     │  │
│  │     a) User 생성                                                │  │
│  │        - user_id: AUTO_INCREMENT                                   │  │
│  │        - login_id, password, email, nickname                       │  │
│  │        - face_vector, voice_vector                                │  │
│  │     b) UserDeviceConnection 생성                                  │  │
│  │        - user_id: 1                                             │  │
│  │        - device_id: JETSON-001                                   │  │
│  │        - device_alias: "거실"                                     │  │
│  │        - last_connected: NOW()                                     │  │
│  │     c) Connection 생성                                           │  │
│  │        - device_id: JETSON-001                                   │  │
│  │        - connection_status: CONNECTED                              │  │
│  │     d) Session 생성                                             │  │
│  │        - user_id: 1                                              │  │
│  │        - device_id: JETSON-001                                   │  │
│  │        - connection_id: 1                                         │  │
│  │        - robot_status: IDLE                                       │  │
│  │  5. JWT 토큰 생성 (HS256, 24시간)                              │  │
│  │  6. 캐시 삭제                                                   │  │
│  │     Key: signup:temp:{uuid}                                      │  │
│  │  7. 트랜잭션 커밋                                              │  │
│  │  8. 응답 생성                                                  │  │
│  │     {                                                         │  │
│  │       "success": true,                                           │  │
│  │       "data": {                                                 │  │
│  │         "user_id": 1,                                            │  │
│  │         "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",       │  │
│  │         "user": {                                                │  │
│  │           "user_id": 1,                                          │  │
│  │           "nickname": "대연",                                     │  │
│  │           "email": "dae_lee@example.com"                          │  │
│  │         },                                                      │  │
│  │         "session_id": 1                                          │  │
│  │       }                                                         │  │
│  │     }                                                         │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│         │                                                              │
│         ↓ REST API Response (HTTPS)                                     │
└─────────┼───────────────────────────────────────────────────────────────────┘
          │
          ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│                        앱 (Android)                                   │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │                    회원가입 완료 처리                            │  │
│  │  1. 응답 수신                                                   │  │
│  │  2. JWT 토큰 LocalStorage 저장                                   │  │
│  │  3. Session ID 저장                                              │  │
│  │  4. "회원가입 완료!" 메시지 표시                                │  │
│  │  5. 기기 프리셋 초기화                                           │  │
│  │  6. 메인 화면(홈 탭)으로 이동                                    │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 5.2 회원가입 Redis 캐시 구조

```
Redis Key: signup:temp:{uuid}
Type: Hash
TTL: 30분 (1800초)

Fields:
┌─────────────────────────────────────────────────────────────────────┐
│ Field                    │ Value                             │ Type  │
├─────────────────────────────────────────────────────────────────────┤
│ login_id                 │ "dae_lee"                         │ String │
│ password                 │ "$2b$12$hashed..."                 │ String │
│ email                   │ "dae_lee@example.com"            │ String │
│ nickname                 │ "대연"                            │ String │
│ face_vector             │ [0.123, -0.456, ...]            │ JSON   │
│ voice_vector            │ [0.123, -0.456, ...]            │ JSON   │
│ device_alias            │ "거실"                            │ String │
│ timestamp               │ 1640739900                       │ Number │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 6. 데이터베이스 스키마

### 6.1 ERD (Entity Relationship Diagram)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                            User                                      │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │ PK: user_id (AUTO_INCREMENT)                                     │  │
│  │    login_id (VARCHAR(50), UNIQUE)                                │  │
│  │    password (VARCHAR(255))                                         │  │
│  │    email (VARCHAR(255), UNIQUE)                                   │  │
│  │    nickname (VARCHAR(20))                                         │  │
│  │    face_vector (JSON)                                             │  │
│  │    voice_vector (JSON)                                            │  │
│  │    created_at (TIMESTAMP)                                         │  │
│  │    updated_at (TIMESTAMP)                                         │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│         │                                                              │
│         │ 1:N                                                          │
│         ↓                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │                      Session                                   │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │ PK: session_id (AUTO_INCREMENT)                             │  │  │
│  │  │    user_id (FK → User.user_id)                             │  │  │
│  │  │    device_id (FK → Device.device_id)                         │  │  │
│  │  │    connection_id (FK → Connection.connection_id)               │  │  │
│  │  │    robot_status (ENUM: IDLE, TRACKING, MOVING, ASIDE)      │  │  │
│  │  │    last_voice_command (VARCHAR(100))                          │  │  │
│  │  │    created_at (TIMESTAMP)                                     │  │  │
│  │  │    ended_at (TIMESTAMP, NULL)                                 │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  │         │                                                        │  │
│  │         │ N:1                                                    │  │
│  │         ↓                                                        │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │              UserManualPreset                             │  │  │
│  │  │  PK: preset_id (AUTO_INCREMENT)                             │  │  │
│  │  │     user_id (FK → Session.user_id)                          │  │  │
│  │  │     session_id (FK → Session.session_id)                    │  │  │
│  │  │     preset_name (VARCHAR(50))                              │  │  │
│  │  │     x (INT)                                                │  │
│  │  │     y (INT)                                                │  │
│  │  │     z (INT)                                                │  │
│  │  │     tilt (INT)                                              │  │
│  │  │     has (INT)                                               │  │
│  │  │     created_at (TIMESTAMP)                                   │  │  │
│  │  │     is_active (BOOLEAN, DEFAULT FALSE)                        │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│                                                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │                     BiometricLog                                │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │ PK: biometric_history_id (AUTO_INCREMENT)                     │  │  │
│  │  │     user_id (FK → User.user_id)                             │  │  │
│  │  │     change_type (ENUM: FACE_INITIAL, VOICE_INITIAL,         │  │  │
│  │  │                     FACE_UPDATE, VOICE_UPDATE)                │  │  │
│  │  │     previous_vector (JSON, NULL)                             │  │  │
│  │  │     new_vector (JSON, NULL)                                  │  │  │
│  │  │     changed_at (TIMESTAMP)                                   │  │  │
│  │  │     change_reason (TEXT, NULL)                                │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────┘
                                                                        │
┌─────────────────────────────────────────────────────────────────────────────┐
│                            Device                                    │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │ PK: device_id (AUTO_INCREMENT)                                    │  │
│  │    device_type (VARCHAR(50))                                      │  │
│  │    serial_number (VARCHAR(50), UNIQUE)                            │  │
│  │    firmware_version (VARCHAR(20))                                  │  │
│  │    latest_firmware_version (VARCHAR(20), NULL)                     │  │
│  │    created_at (TIMESTAMP)                                        │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│         │                                                              │
│         │ 1:N                                                          │
│         ↓                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │                    Connection                                    │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │ PK: connection_id (AUTO_INCREMENT)                             │  │  │
│  │  │    device_id (FK → Device.device_id)                         │  │  │
│  │  │    connection_status (ENUM: CONNECTED, GRACE_PERIOD, EXPIRED)│  │  │
│  │  │    wifi_signal (INT, DEFAULT 0)                              │  │
│  │  │    last_heartbeat (TIMESTAMP)                                 │  │  │
│  │  │    created_at (TIMESTAMP)                                     │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│                                                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │              UserDeviceConnection                               │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │ PK: connection_id (AUTO_INCREMENT)                             │  │  │
│  │  │    user_id (FK → User.user_id)                             │  │  │
│  │  │    device_id (FK → Device.device_id)                         │  │  │
│  │  │    device_alias (VARCHAR(50), NULL)                           │  │  │
│  │  │    connected_device (VARCHAR(50), NULL)                        │  │  │
│  │  │    last_connected (TIMESTAMP)                                 │  │  │
│  │  │    created_at (TIMESTAMP)                                     │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 7. 와이어프레임 요약

### 7.1 주요 통신 경로

| 경로 | 통신 방식 | 주요 엔드포인트 | 간격 |
|------|-----------|-----------------|------|
| 앱 → 서버 | REST API (HTTPS) | /api/auth/*, /api/register/* | 요청 시 |
| 앱 → Jetson | HTTP (로컬) | http://192.168.x.x:8000/* | 요청 시 |
| Jetson → 서버 | WebSocket (WSS) | wss://i14a104.p.ssafy.io:8000/ws/heartbeat/ | 10초 |
| Jetson → RPi | 유선 | 내부 프로토콜 | 실시간 |

### 7.2 데이터 흐름 요약

1. **인증 흐름:** 앱 → Jetson (이미지) → 벡터화 → 서버 (벡터) → 인증 → JWT 발급 → 앱
2. **하트비트 흐름:** Jetson → 서버 (10초) → heartbeat_ack → Connection 상태 저장 → 앱 알림
3. **제어 흐름:** 앱 → 서버 (명령) → Session 업데이트 → RPi (제어) → 완료 → 서버 → 앱
4. **회원가입 흐름:** 앱 → Jetson (벡터화) → 서버 (캐시) → 최종 완료 → User 생성 → JWT 발급

---

**문서 버전:** 1.0  
**작성일:** 2026-01-30  
**최종 수정일:** 2026-01-30