# SARVIS 트러블슈팅 가이드 (전체)

## 📱 React Native / Expo 에러

### 1. useRouter 최상위 호출 에러
**파일:** `app/index.tsx`
**증상:**
```
Error: Invalid hook call. Hooks can only be called inside of the body of a function component.
```
**해결:** 불필요한 `useRouter` import 및 호출 제거

---

### 2. HTML 엔티티 이스케이프 에러
**파일:** `app/(auth)/signup-voice.tsx`
**증상:**
```
Parse error: '>' expected
```
**원인:** JSX에서 따옴표 이스케이프 안 됨
**해결:** `"` → `&quot;`로 변경

---

### 3. 존재하지 않는 변수 참조
**파일:** `app/(tabs)/explore.tsx`
**증상:**
```
ReferenceError: setPreset is not defined
```
**해결:** `setPreset` 변수 제거하고 상태값 직접 사용

---

### 4. Unable to resolve module 에러
**파일:** `app/ai-test.tsx`
**증상:**
```
Unable to resolve ./modules/face-detector
```
**원인:** import 경로에 파일이 실제로 없음
**해결:** 실제 파일 위치/이름과 import 경로 일치시킴

---

## 🔐 로그인/회원가입

### 5. 얼굴 로그인 네트워크 에러
**파일:** `app/(auth)/login-face.tsx`
**증상:** API 호출 시 네트워크 에러
**해결:** 임시로 API 호출 건너뛰고 더미 데이터로 성공 처리
```typescript
const dummyAccessToken = 'dummy-token';
await storage.setTokens(dummyAccessToken, dummyRefreshToken);
router.replace({ pathname: '/(tabs)' } as any);
```

---

### 6. 로그인 중 입력 필드 혼란
**파일:** `app/(auth)/login-id.tsx`
**증상:** 로딩 중에도 입력 필드가 보여서 혼란스러움
**해결:** 로딩 중에는 입력 필드 숨기고 스피너만 표시
```typescript
{!loading ? (
  // 입력 필드들
) : (
  <ActivityIndicator size="large" />
)}
```

---

### 7. 회원가입 화면 스크롤 튕김
**파일:** `app/(auth)/signup-info.tsx`
**증상:** 스크롤 시 화면이 튕김
**원인:** `KeyboardAvoidingView`와 `ScrollView` 충돌
**해결:**
- `KeyboardAvoidingView` 제거
- `flexGrow` 제거하고 `padding` 사용
- `automaticallyAdjustContentInsets={false}` 유지

---

### 8. 비밀번호 정책 단순화
**변경:** 복잡한 비밀번호 → 숫자 6자리
```typescript
const pwRegex = /^[0-9]{6}$/;
<TextInput
  keyboardType="numeric"
  maxLength={6}
  placeholder="숫자 6자리"
/>
```

---

### 9. 닉네임 한글 입력 불가
**파일:** `app/(auth)/signup-info.tsx`
**증상:** 닉네임 입력 시 한글 안 됨
**해결:**
```typescript
<TextInput
  autoCapitalize="none"
  autoCorrect={false}
/>
```

---

### 10. 회원가입 버튼 활성화 안 됨
**증상:** 모든 정보 입력해도 버튼 활성화 안 됨
**해결:** 실시간 유효성 검사 표시 추가
```typescript
// 진행 상황 표시
title={`정보 입력 완료 ${canSubmit ? '✓' : `(${completedCount}/7)`}`}

// 실시간 체크마크
<Text style={nicknameValid ? styles.hintSuccess : styles.hintError}>
  닉네임: 2-20자 {nicknameValid ? '✓' : '✗'}
</Text>
```

---

## 📷 카메라 기능

### 11. 카메라 권한 요청 안 됨
**파일:** `app/(auth)/login-face.tsx`
**증상:** 카메라 화면이 안 뜸
**해결:** 화면 진입 시 권한 자동 요청 로직 추가
```typescript
useEffect(() => {
  (async () => {
    const { status } = await Camera.requestCameraPermissionsAsync();
    if (status !== 'granted') {
      Alert.alert('카메라 권한이 필요합니다');
    }
  })();
}, []);
```

---

### 12. app.json 카메라 권한 미설정
**증상:** Android/iOS에서 카메라 작동 안 됨
**해결:** `app.json`에 권한 추가
```json
{
  "expo": {
    "ios": {
      "infoPlist": {
        "NSCameraUsageDescription": "얼굴 인식을 위해 카메라가 필요합니다"
      }
    },
    "android": {
      "permissions": ["CAMERA"]
    }
  }
}
```

---

### 13. 에뮬레이터 카메라 검은 화면
**증상:** 에뮬레이터에서 카메라 프리뷰가 검은 화면
**원인:** AVD Camera 소스가 Webcam0이 아님
**해결:**
1. AVD Manager → 에뮬레이터 설정 (⚙️)
2. Show Advanced Settings
3. Camera Front/Back → **Webcam0** 선택
4. 에뮬레이터 재시작

---

### 14. Android 카메라 에뮬레이터 미지원
**증상:** 에뮬레이터에서 카메라 작동 안 됨
**원인:** 에뮬레이터 전면 카메라 미지원, CameraView 한계
**해결:** **실기기 테스트로 전환** (권장)

---

## 🤖 얼굴 인식 AI 모듈

### 15. FaceDetectorModule.class 오류
**증상:**
```
Duplicate class com.google.mlkit.vision.face.FaceDetectorModule
```
**해결:** `app.json`에서 autolinking 제외
```json
"expo": {
  "autolinking": {
    "exclude": ["@react-native-ml-kit/face-detection"]
  }
}
```

---

### 16. Expo SDK 호환성
**증상:** SDK 54에서 빌드 실패
**해결:** SDK 54 → 50 다운그레이드
```bash
npm install expo@~50.0.0
npx expo install --fix
```

---

### 17. Metro 서버 오류
**증상:**
```
Metro bundler failed to start
```
**해결:** Node.js 18 → 20 업그레이드
```bash
nvm install 20
nvm use 20
```

---

### 18. Camera 컴포넌트 deprecated
**증상:** `Camera` 컴포넌트 사용 불가
**해결:** `Camera` → `CameraView`로 변경
```typescript
import { CameraView } from 'expo-camera';

<CameraView
  style={styles.camera}
  facing="front"
/>
```

---

## 🔧 Android Native 빌드

### 19. adb: command not found
**해결:**
```bash
export ANDROID_HOME=~/AppData/Local/Android/Sdk
export PATH=$PATH:$ANDROID_HOME/platform-tools
```

---

### 20. JAVA_HOME is not set
**해결:**
1. Java 17 또는 21 설치
2. 환경변수 설정
   - 변수 이름: `JAVA_HOME`
   - 변수 값: `C:\Program Files\Eclipse Adoptium\jdk-21.0.x`
3. **PC 재부팅**

---

### 21. Unsupported class file major version 69
**원인:** Java 25 (너무 최신)
**해결:** Java 17 또는 21로 다운그레이드

---

### 22. JAVA_HOME 환경변수 미적용
**해결:**
1. 모든 터미널 완전 종료
2. 사용자 변수의 `JAVA_HOME` 삭제 (있다면)
3. 시스템 변수만 사용
4. **PC 재부팅**

---

### 23. 네이티브 모듈 인식 안 됨
**증상:** `_apiAuth.authAPI.requestFaceLogin is not a function`
**원인:** `npx expo start` (Expo Go) 사용
**해결:**
```bash
# ❌ 잘못됨
npx expo start

# ✅ 올바름
npx expo run:android
```

---

### 24. 잘못된 디렉토리에서 실행
**증상:** `ConfigError: package.json does not exist`
**해결:**
```bash
# 반드시 FRONTEND/sarvis 폴더에서 실행
cd /c/DEV/SARVIS_WORK/sarvis_fe/sarvis
npx expo run:android
```

---

### 25. 빌드가 0%에서 멈춘 것처럼 보임
**증상:**
```
<-------------> 0% INITIALIZING [52s]
```
**해결:** 정상임 (첫 빌드 10-15분 소요), 그냥 기다리기

---

## 📱 Android 실기기 연결

### 26. USB 디버깅 활성화 안 됨
**증상:** USB 디버깅 옵션이 비활성화됨 (삼성 기기)
**원인:** 보안 위험 자동 차단
**해결:**
1. 설정 → 보안
2. "USB 디버깅 차단" 옵션 해제
3. 개발자 옵션 → USB 디버깅 ON

---

### 27. adb devices에서 unauthorized
**증상:**
```
R3CX50ES9WR    unauthorized
```
**해결:** 폰 화면에서 "USB 디버깅 허용" 팝업 승인

---

### 28. 개발자 옵션 활성화
**방법:**
1. 설정 → 휴대전화 정보
2. 빌드 번호 **7회 연타**
3. "개발자가 되었습니다!" 메시지 확인
4. 개발자 옵션 활성화됨

---

## 🌿 Git 관련

### 29. 원격 브랜치 직접 checkout 불가
**증상:**
```
fatal: 'origin/feature/...' is not a commit
```
**해결:** 로컬 브랜치 생성 후 작업
```bash
git fetch
git switch -c feature/frontend/face_detector_ai origin/feature/frontend/face_detector_ai
```

---

## 💡 핵심 팁

### 환경변수 변경 후
1. 모든 터미널 완전 종료
2. PC 재부팅
3. 새 터미널에서 확인

### Java 버전
- ✅ Java 17 (가장 안정)
- ✅ Java 21 (작동)
- ❌ Java 25 (Gradle 지원 안 됨)

### Expo 실행 방법
- ❌ `npx expo start` → Expo Go (네이티브 코드 불가)
- ✅ `npx expo run:android` → Development Build (네이티브 코드 가능)

### Expo SDK
- SDK 50이 가장 안정적 (54는 호환성 문제 많음)

### Node.js
- 최소 18, 권장 20 이상

### 카메라 테스트
- **실기기 우선**: 네이티브 기능은 실기기 테스트 필수
- 에뮬레이터: Webcam0 설정 확인 필요

### 폴더 위치
- 반드시 `FRONTEND/sarvis` (package.json 있는 폴더)에서 명령 실행

### 빌드 시간
- 첫 빌드: 10-15분 (Gradle 다운로드)
- 이후: 1-2분

---

## 🎯 빠른 체크리스트

실행 전 반드시 확인:
- [ ] Java 17 또는 21 설치 및 환경변수 설정
- [ ] Android SDK PATH 설정
- [ ] 프로젝트 폴더 위치 확인 (`FRONTEND/sarvis`)
- [ ] `npx expo run:android`로 실행 (start 아님)
- [ ] 실기기 연결 상태 확인 (`adb devices`)
- [ ] USB 디버깅 허용 (폰 화면 팝업)
- [ ] 카메라 권한 허용 (앱 실행 시)